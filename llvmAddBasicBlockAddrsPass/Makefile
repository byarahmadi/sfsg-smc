LLVM_CONFIG?=llvm-config
CXX=clang

SRC_DIR?=$(PWD)
LDFLAGS+=$(shell $(LLVM_CONFIG) --ldflags)
COMMON_FLAGS=-Wall -Wextra
CXXFLAGS+=$(COMMON_FLAGS) $(shell $(LLVM_CONFIG) --cxxflags)
CPPFLAGS+=$(shell $(LLVM_CONFIG) --cppflags) -I$(SRC_DIR)

LOADABLE_MODULE_OPTIONS=-shared -W1 -O1

LLVM_ADD_BASIC_BLOCK_ADDRS_PASS=add_basicblock_addrs_pass.so
LLVM_ADD_BASIC_BLOCK_ADDRS_OBJECTS=llvmAddBasicBlockAddrsPass.o

default:$(LLVM_ADD_BASIC_BLOCK_ADDRS_PASS)

%o:$(SRC_DIR)/%.cpp
	$(CXX) -c $(CPPFLAGS) $(CXXFLAGS) $<
$(LLVM_ADD_BASIC_BLOCK_ADDRS_PASS):$(LLVM_ADD_BASIC_BLOCK_ADDRS_OBJECTS)
	$(CXX) -o $@ $(LOADABLE_MODULE_OPTIONS) $(CXXFLAGS) $(LDFLAGS) $^
clean:
	rm -f $(LLVM_ADD_BASIC_BLOCK_ADDRS_PASS) $(LLVM_ADD_BASIC_BLOCK_ADDRS_OBJECTS)

